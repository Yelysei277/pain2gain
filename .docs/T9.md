# T9 ‚Äî Real Reddit API Integration

**Goal:**  
Replace mock Reddit data with real API calls to fetch live posts from target subreddits.

---

## üçÄ Deliverables

- Reddit API credentials setup
- Updated `reddit-source.ts` to fetch from Reddit API
- Rate limiting and error handling
- Fallback mechanism to cached/mock data

---

## üõ† Steps

1. **Set up Reddit API credentials:**
   - Create a Reddit app at [reddit.com/prefs/apps](https://www.reddit.com/prefs/apps)
   - Choose "script" type application
   - Get `client_id` and `client_secret`
   - Add to `.env.local`:
     ```
     REDDIT_CLIENT_ID=<your-client-id>
     REDDIT_CLIENT_SECRET=<your-client-secret>
     REDDIT_USER_AGENT=Pain2Gain/1.0 (by /u/yourusername)
     ```

2. **Install Reddit API client (optional):**
   - Option A: Use `snoowrap` library: `npm i snoowrap`
   - Option B: Use native `fetch` with OAuth2 token

3. **Implement OAuth2 authentication:**
   ```ts
   async function getRedditAccessToken(): Promise<string> {
     const auth = Buffer.from(
       `${process.env.REDDIT_CLIENT_ID}:${process.env.REDDIT_CLIENT_SECRET}`
     ).toString('base64');
     
     const response = await fetch('https://www.reddit.com/api/v1/access_token', {
       method: 'POST',
       headers: {
         'Authorization': `Basic ${auth}`,
         'Content-Type': 'application/x-www-form-urlencoded',
         'User-Agent': process.env.REDDIT_USER_AGENT!,
       },
       body: 'grant_type=client_credentials',
     });
     
     const data = await response.json();
     return data.access_token;
   }
   ```

4. **Update `loadRedditPosts()` function:**
   ```ts
   export async function loadRedditPosts(
     subreddits: string[] = ['startups', 'entrepreneur', 'SaaS'],
     limit: number = 100
   ): Promise<RedditPost[]> {
     try {
       const token = await getRedditAccessToken();
       const allPosts: RedditPost[] = [];
       
       for (const subreddit of subreddits) {
         const response = await fetch(
           `https://oauth.reddit.com/r/${subreddit}/hot.json?limit=${limit}`,
           {
             headers: {
               'Authorization': `Bearer ${token}`,
               'User-Agent': process.env.REDDIT_USER_AGENT!,
             },
           }
         );
         
         if (!response.ok) {
           console.warn(`Failed to fetch from r/${subreddit}`);
           continue;
         }
         
         const data = await response.json();
         const posts = data.data.children.map((child: any) => ({
           id: child.data.id,
           subreddit: `r/${child.data.subreddit}`,
           title: child.data.title,
           body: child.data.selftext || '',
           upvotes: child.data.ups,
           num_comments: child.data.num_comments,
           created_utc: child.data.created_utc,
         }));
         
         allPosts.push(...posts);
       }
       
       return allPosts;
     } catch (error) {
       console.error('Reddit API error, falling back to mock data:', error);
       // Fallback to mock data
       return loadRedditPostsFromFile();
     }
   }
   ```

5. **Add rate limiting:**
   - Reddit API allows 60 requests per minute per client
   - Implement simple rate limiter or use a library like `bottleneck`
   - Cache access tokens (they expire after 1 hour)

6. **Update API route `/api/generate`:**
   - Ensure it uses the new `loadRedditPosts()` function
   - Handle API failures gracefully

7. **Test with real subreddits:**
   - Verify posts are fetched correctly
   - Check that fallback works when API is unavailable

---

## üí° Notes

- Reddit API has rate limits: 60 requests/minute for OAuth2
- Access tokens expire after 1 hour; implement token caching
- Consider caching fetched posts in database (sources table) to reduce API calls
- Keep `loadRedditPostsFromFile()` as fallback for development/testing
- Alternative: Use Pushshift API for historical data (no auth required, but may be slower)

