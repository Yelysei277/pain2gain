
# T5 â€” Supabase Database Integration

**Goal:**  
Replace local JSON storage with a real Supabase Postgres database for persistence and scalability.

---

## ğŸ€ Deliverables
- Supabase client setup  
- Database schema (tables: `ideas`, `sources`, `subscriptions`)  
- API endpoints migrated from file-based storage to Supabase

---

## ğŸ›  Steps
1. **Set up Supabase project:**
   - Create a new project on [supabase.com](https://supabase.com)
   - Copy the API URL and anon key to `.env.local`:
     ```
     SUPABASE_URL=<your-url>
     SUPABASE_ANON_KEY=<your-key>
     ```
2. **Add Supabase client:**
   ```ts
   import { createClient } from '@supabase/supabase-js';
   export const supabase = createClient(process.env.SUPABASE_URL!, process.env.SUPABASE_ANON_KEY!);
   ```
3. **Create tables:**
   ```sql
   create table ideas (
     id bigint generated by default as identity primary key,
     title text not null,
     elevator_pitch text,
     pain_point text,
     topic text,
     score int,
     source_id bigint references sources(id) on delete set null,
     created_at timestamptz default now()
   );

   create table sources (
     id bigint generated by default as identity primary key,
     subreddit text,
     url text,
     created_at timestamptz default now()
   );

   create table subscriptions (
     id bigint generated by default as identity primary key,
     user_id uuid,
     email text,
     topics text[],
     is_active boolean default true,
     unsubscribe_token text unique,
     created_at timestamptz default now()
   );
   ```
4. **Update API routes:**
   - `/api/generate` â†’ insert ideas directly into `ideas` table
   - `/api/ideas` â†’ query from Supabase (instead of `data/ideas.json`)
5. **Test database read/write** locally and in deployment.

---

## ğŸ’¡ Notes
- Supabase Auth will be used later for user-related actions (see T6).  
- Keep `data/ideas.json` as a fallback for local testing.
